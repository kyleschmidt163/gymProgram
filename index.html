<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>5-Week RPE Program Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --bg: #0a0a0a;
            --surface: #141414;
            --surface-hover: #1a1a1a;
            --border: #2a2a2a;
            --text: #e8e8e8;
            --text-muted: #888;
            --accent: #ff4d00;
            --accent-glow: rgba(255, 77, 0, 0.3);
            --success: #00ff88;
            --purple: #a855f7;
            --green: #22c55e;
            --week1: #ff4d00;
            --week2: #ff8c00;
            --week3: #ffc800;
            --week4: #00ff88;
            --week5: #00bfff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'IBM Plex Mono', monospace;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container { max-width: 900px; margin: 0 auto; padding: 40px 20px; }

        header { text-align: center; margin-bottom: 20px; }

        h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(2.5rem, 8vw, 4rem);
            letter-spacing: 0.05em;
            color: var(--accent);
            text-shadow: 0 0 40px var(--accent-glow);
            line-height: 1;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        .intro-block {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 20px;
            margin-bottom: 30px;
        }

        .intro-text {
            color: #888;
            font-size: 0.8rem;
            font-style: italic;
            line-height: 1.8;
            text-align: left;
        }

        .intro-text a {
            color: var(--accent);
        }

        .copy-code-btn {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 12px 20px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            cursor: pointer;
            transition: background 0.2s, border-color 0.2s;
            margin-bottom: 20px;
            display: block;
            width: 100%;
            text-align: center;
        }

        .copy-code-btn:hover {
            background: var(--surface-hover);
            border-color: var(--accent);
        }

        .copy-code-btn.copied {
            background: var(--green);
            color: var(--bg);
            border-color: var(--green);
        }

        .setup-panel {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.4rem;
            letter-spacing: 0.1em;
            color: var(--accent);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .section-subtitle {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin: 25px 0 15px 0;
        }

        .lift-input-block {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 20px;
            margin-bottom: 15px;
        }

        .lift-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            letter-spacing: 0.1em;
            color: var(--success);
            margin-bottom: 15px;
        }

        .lift-name.optional { color: var(--text-muted); }

        .optional-tag {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-family: 'IBM Plex Mono', monospace;
            margin-left: 10px;
        }

        .lift-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        label {
            display: block;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        input, select {
            width: 100%;
            padding: 10px 12px;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.95rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23888' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }

        select:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .e1rm-display {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 10px;
            text-align: right;
        }

        .e1rm-display span { color: var(--accent); font-weight: 600; }

        .options-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid var(--border);
        }

        .button-row {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .generate-btn, .export-btn {
            flex: 1;
            padding: 18px;
            border: none;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .generate-btn {
            background: var(--accent);
            color: var(--bg);
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px var(--accent-glow);
        }

        .export-btn {
            background: var(--purple);
            color: white;
            display: none;
        }

        .export-btn.visible {
            display: block;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(168, 85, 247, 0.3);
        }

        .program-output { display: none; }
        .program-output.visible { display: block; }

        .week-block {
            background: var(--surface);
            border: 1px solid var(--border);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .week-header {
            padding: 15px 20px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            letter-spacing: 0.1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .week-header:hover { background: var(--surface-hover); }

        .week-1 .week-header { border-left: 4px solid var(--week1); }
        .week-2 .week-header { border-left: 4px solid var(--week2); }
        .week-3 .week-header { border-left: 4px solid var(--week3); }
        .week-4 .week-header { border-left: 4px solid var(--week4); }
        .week-5 .week-header { border-left: 4px solid var(--week5); }

        .week-header .rpe-badge {
            font-size: 0.9rem;
            padding: 4px 12px;
            background: var(--bg);
            border: 1px solid var(--border);
        }

        .week-1 .rpe-badge { color: var(--week1); border-color: var(--week1); }
        .week-2 .rpe-badge { color: var(--week2); border-color: var(--week2); }
        .week-3 .rpe-badge { color: var(--week3); border-color: var(--week3); }
        .week-4 .rpe-badge { color: var(--week4); border-color: var(--week4); }
        .week-5 .rpe-badge { color: var(--week5); border-color: var(--week5); }

        .week-content {
            padding: 0 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, padding 0.4s ease;
        }

        .week-content.open {
            max-height: 8000px;
            padding: 20px;
            border-top: 1px solid var(--border);
        }

        .day-block { 
            margin-bottom: 40px; 
            padding: 20px; 
            background: var(--bg);
            border: 1px solid var(--border);
        }
        .day-block:last-child { margin-bottom: 0; }

        .day-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 0.1em;
            color: var(--accent);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }

        .exercise-row {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            align-items: center;
        }

        .exercise-row:last-child { border-bottom: none; }

        .exercise-name { font-weight: 500; }
        .exercise-name.main { color: var(--purple); }
        .exercise-name.backoff { color: var(--purple); opacity: 0.7; }
        .exercise-name.secondary { color: var(--green); }
        .exercise-name.accessory { color: var(--text-muted); }
        .exercise-name.superset { color: var(--text-muted); font-style: italic; }

        .exercise-prescription {
            text-align: right;
            font-size: 0.9rem;
            color: var(--text-muted);
            white-space: nowrap;
        }

        .exercise-prescription .weight { color: var(--text); font-weight: 600; }

        .exercise-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-left: 8px;
        }

        .superset-label {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent);
            margin-left: 8px;
        }

        .toggle-arrow { transition: transform 0.3s; }
        .week-header.open .toggle-arrow { transform: rotate(180deg); }

        .section-divider { height: 1px; background: var(--border); margin: 15px 0; }

        .info-box {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 15px;
            margin-top: 20px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .info-box strong { color: var(--accent); }

        .collapsible-section {
            margin-top: 30px;
        }

        .collapsible-header {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 15px 20px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 0.1em;
            color: var(--accent);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .collapsible-header:hover {
            background: var(--surface-hover);
        }

        .collapsible-content {
            background: var(--surface);
            border: 1px solid var(--border);
            border-top: none;
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, padding 0.4s ease;
        }

        .collapsible-content.open {
            max-height: 2000px;
            padding: 20px;
        }

        .collapsible-content h4 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            color: var(--success);
            margin: 15px 0 10px 0;
        }

        .collapsible-content h4:first-child {
            margin-top: 0;
        }

        .collapsible-content p, .collapsible-content ol {
            font-size: 0.85rem;
            color: var(--text-muted);
            line-height: 1.7;
        }

        .collapsible-content ol {
            padding-left: 20px;
            margin: 10px 0;
        }

        .collapsible-content li {
            margin-bottom: 5px;
        }

        @media (max-width: 600px) {
            .container { padding: 20px 15px; }
            .setup-panel { padding: 20px; }
            .lift-inputs { grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
            .lift-input-block { padding: 15px; }
            .exercise-row { grid-template-columns: 1fr; gap: 5px; }
            .exercise-prescription { text-align: left; }
            .button-row { flex-direction: column; }
            .options-row { grid-template-columns: 1fr 1fr; }
        }

        @media print {
            .week-content { max-height: none !important; padding: 20px !important; }
            .collapsible-content { max-height: none !important; padding: 20px !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>5-Week Program Generator</h1>
            <p class="subtitle">4 weeks + deload</p>
            <p style="color: var(--purple); font-size: 0.85rem; margin-top: 10px; font-weight: 600;">RPE = difficulty out of 10</p>
        </header>

        <button class="copy-code-btn" onclick="copyCodeToClipboard(this)">ðŸ“‹ Copy Code to Clipboard</button>

        <div class="intro-block">
            <p class="intro-text">
                Hello bruh/bruhette, enjoy getting fkn stacked as. There are three days or four, anything less is a waste of time, anything more you can figure that out yourself.<br><br>
                Don't ask me any questions, thats the point of this right? Just download the code and make your own changes, follow instructions on making a page here, or don't IDC<br>
                <a href="https://docs.github.com/en/pages/getting-started-with-github-pages/creating-a-github-pages-site" target="_blank">https://docs.github.com/en/pages/getting-started-with-github-pages/creating-a-github-pages-site</a>
            </p>
        </div>

        <div class="collapsible-section">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                How to add as an app for iOS
                <span class="toggle-arrow">â–¼</span>
            </div>
            <div class="collapsible-content">
                <ol>
                    <li>Open the website in Safari</li>
                    <li>Tap the Share button (square with an arrow) at the bottom of the screen</li>
                    <li>Scroll down and tap "Add to Home Screen"</li>
                    <li>Choose a name for the shortcut (or keep the default)</li>
                    <li>Tap "Add" in the top-right corner</li>
                    <li>The website shortcut will appear on your home screen</li>
                </ol>
            </div>
        </div>

        <div class="collapsible-section">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
                How to add as an app for Android
                <span class="toggle-arrow">â–¼</span>
            </div>
            <div class="collapsible-content">
                <h4>On Android (Chrome):</h4>
                <ol>
                    <li>Open the website in Chrome</li>
                    <li>Tap the three-dot menu (â‹®) in the top-right corner</li>
                    <li>Tap "Add to Home screen" or "Install app"</li>
                    <li>Choose a name for the shortcut (or keep the default)</li>
                    <li>Tap "Add" or "Install"</li>
                    <li>The website shortcut will appear on your home screen</li>
                </ol>

                <h4>On Android (Firefox):</h4>
                <ol>
                    <li>Open the website in Firefox</li>
                    <li>Tap the three-dot menu (â‹®) in the top-right corner</li>
                    <li>Tap "Add to home screen"</li>
                    <li>Choose a name for the shortcut</li>
                    <li>Tap "Add"</li>
                    <li>The shortcut will appear on your home screen</li>
                </ol>

                <h4>On Android (Samsung Internet):</h4>
                <ol>
                    <li>Open the website in Samsung Internet</li>
                    <li>Tap the three-dot menu (â‹®)</li>
                    <li>Tap "Add page to" â†’ "Home screen"</li>
                    <li>Choose a name and tap "Add"</li>
                    <li>The shortcut will appear on your home screen</li>
                </ol>
            </div>
        </div>

        <div class="setup-panel" style="margin-top: 30px;">
            <h2 class="section-title">Program Focus</h2>
            <div class="input-group" style="max-width: 320px;">
                <label>Select Program</label>
                <select id="accessoryFocus" onchange="handleFocusChange()" style="margin-top: 6px;">
                    <option value="bodybuilding">Bodybuilding</option>
                    <option value="powerlifting">Powerlifting</option>
                    <option value="benchmax">Bench Max - 4 Day</option>
                    <option value="beginner_machine">Beginner - Machine Only</option>
                </select>
            </div>
        </div>

        <div class="setup-panel">
            <h2 class="section-title">Main Lifts <span style="font-family: 'IBM Plex Mono', monospace; font-size: 0.65rem; color: var(--text-muted); font-weight: 400;">(add your most recent numbers here to calculate)</span></h2>
            
            <!-- Deadlift -->
            <div class="lift-input-block">
                <div class="lift-name">Deadlift</div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="dead-weight" placeholder="140" step="2.5" oninput="updateE1RM('dead')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="dead-reps" onchange="updateE1RM('dead')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="dead-rpe" onchange="updateE1RM('dead')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="dead-e1rm">â€”</span></div>
            </div>

            <!-- Squat -->
            <div class="lift-input-block">
                <div class="lift-name">Squat</div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="squat-weight" placeholder="120" step="2.5" oninput="updateE1RM('squat')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="squat-reps" onchange="updateE1RM('squat')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="squat-rpe" onchange="updateE1RM('squat')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="squat-e1rm">â€”</span></div>
            </div>

            <!-- Bench -->
            <div class="lift-input-block">
                <div class="lift-name">Bench Press</div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="bench-weight" placeholder="80" step="2.5" oninput="updateE1RM('bench')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="bench-reps" onchange="updateE1RM('bench')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="bench-rpe" onchange="updateE1RM('bench')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="bench-e1rm">â€”</span></div>
            </div>

            <!-- Push Press -->
            <div class="lift-input-block">
                <div class="lift-name">Push Press / OHP</div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="ohp-weight" placeholder="50" step="2.5" oninput="updateE1RM('ohp')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="ohp-reps" onchange="updateE1RM('ohp')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="ohp-rpe" onchange="updateE1RM('ohp')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="ohp-e1rm">â€”</span></div>
            </div>

            <h3 class="section-subtitle">Secondary Lifts (Optional)</h3>
            <p style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 15px;">Weights are either calculated or left blank if these fields are unoccupied</p>

            <!-- Row -->
            <div class="lift-input-block">
                <div class="lift-name optional">Bent Over Row / Pendlay Row<span class="optional-tag">(for Push Press day)</span></div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="row-weight" placeholder="â€”" step="2.5" oninput="updateE1RM('row')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="row-reps" onchange="updateE1RM('row')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="row-rpe" onchange="updateE1RM('row')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="row-e1rm">â€”</span></div>
            </div>

            <!-- Front Squat / High Bar Squat -->
            <div class="lift-input-block">
                <div class="lift-name optional">Front Squat / High Bar Squat<span class="optional-tag">(for Deadlift day)</span></div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="frontsquat-weight" placeholder="â€”" step="2.5" oninput="updateE1RM('frontsquat')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="frontsquat-reps" onchange="updateE1RM('frontsquat')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="frontsquat-rpe" onchange="updateE1RM('frontsquat')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="frontsquat-e1rm">â€”</span></div>
            </div>

            <!-- Romanian Deadlift -->
            <div class="lift-input-block">
                <div class="lift-name optional">Romanian Deadlift<span class="optional-tag">(for Squat day)</span></div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="rdl-weight" placeholder="â€”" step="2.5" oninput="updateE1RM('rdl')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="rdl-reps" onchange="updateE1RM('rdl')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="rdl-rpe" onchange="updateE1RM('rdl')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="rdl-e1rm">â€”</span></div>
            </div>

            <!-- Larsen Press -->
            <div class="lift-input-block">
                <div class="lift-name optional">Larsen Press<span class="optional-tag">(for Bench day - PL focus)</span></div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="larsen-weight" placeholder="â€”" step="2.5" oninput="updateE1RM('larsen')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="larsen-reps" onchange="updateE1RM('larsen')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="larsen-rpe" onchange="updateE1RM('larsen')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="larsen-e1rm">â€”</span></div>
            </div>

            <div class="options-row">
                <div class="input-group">
                    <label>Target Rep Range</label>
                    <select id="repRange">
                        <option value="1">1 rep (Peaking)</option>
                        <option value="2">2 reps</option>
                        <option value="3">3 reps (Strength)</option>
                        <option value="4">4 reps</option>
                        <option value="5" selected>5 reps (Balanced)</option>
                        <option value="6">6 reps</option>
                        <option value="7">7 reps</option>
                        <option value="8">8 reps (Hypertrophy)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Training Days</label>
                    <select id="trainingDays">
                        <option value="4" selected>4 Days (Recommended)</option>
                        <option value="3">3 Days (Combined Legs)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Progression Goal</label>
                    <select id="progressionGoal">
                        <option value="reps">More Reps (Week 4 AMRAP)</option>
                        <option value="weight">More Weight (+2.5kg Week 4)</option>
                    </select>
                </div>
            </div>

            <div class="button-row">
                <button class="generate-btn" onclick="generateProgram()">Generate Program</button>
                <button class="export-btn" id="exportBtn" onclick="exportToPDF()">Print / Save as PDF</button>
            </div>
        </div>

        <div class="program-output" id="programOutput"></div>
    </div>

    <script>
        function copyCodeToClipboard(btn) {
            const html = document.documentElement.outerHTML;
            navigator.clipboard.writeText(html).then(() => {
                btn.textContent = 'âœ“ Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'ðŸ“‹ Copy Code to Clipboard';
                    btn.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                alert('Failed to copy: ' + err);
            });
        }

        const rpeChart = {
            10:   [100, 95.5, 92.2, 89.2, 86.3, 83.7, 81.1, 78.6, 76.2, 73.9, 71.7, 69.4],
            9.5:  [97.8, 93.9, 90.7, 87.8, 85.0, 82.4, 79.9, 77.4, 75.1, 72.9, 70.7, 68.6],
            9:    [95.5, 92.2, 89.2, 86.3, 83.7, 81.1, 78.6, 76.2, 73.9, 71.7, 69.4, 67.5],
            8.5:  [93.9, 90.7, 87.8, 85.0, 82.4, 79.9, 77.4, 75.1, 72.9, 70.7, 68.6, 66.7],
            8:    [92.2, 89.2, 86.3, 83.7, 81.1, 78.6, 76.2, 73.9, 71.7, 69.4, 67.5, 65.3],
            7.5:  [90.7, 87.8, 85.0, 82.4, 79.9, 77.4, 75.1, 72.9, 70.7, 68.6, 66.7, 64.0],
            7:    [89.2, 86.3, 83.7, 81.1, 78.6, 76.2, 73.9, 71.7, 69.4, 67.5, 65.3, 62.6],
            6.5:  [87.8, 85.0, 82.4, 79.9, 77.4, 75.1, 72.9, 70.7, 68.6, 66.7, 64.0, 61.3],
            6:    [86.3, 83.7, 81.1, 78.6, 76.2, 73.9, 71.7, 69.4, 67.5, 65.3, 62.6, 59.9]
        };

        const weeklyRPE = [7, 8, 8.5, 9];
        const validReps = [1, 2, 3, 5, 6, 8];
        const backoffPercent = 0.85;
        const variationPercent = 0.85;

        function getPercentage(reps, rpe) {
            const repIndex = Math.min(Math.max(reps - 1, 0), 11);
            return rpeChart[rpe][repIndex];
        }

        function calculateE1RM(weight, reps, rpe) {
            const percentage = getPercentage(reps, rpe);
            return weight / (percentage / 100);
        }

        function calculateWeight(e1rm, reps, rpe) {
            const percentage = getPercentage(reps, rpe);
            return e1rm * (percentage / 100);
        }

        function roundToPlate(weight) {
            return Math.round(weight / 2.5) * 2.5;
        }

        function getBackoffReps(targetReps, focus, progressionGoal) {
            // If at max rep range (8), don't increase reps
            if (targetReps === 8) return 8;
            
            // Powerlifting + weight focus = +1 rep only
            if (focus === 'powerlifting' && progressionGoal === 'weight') {
                let candidate = targetReps + 1;
                if (validReps.includes(candidate)) return candidate;
                // If +1 doesn't land on valid, try +2
                candidate = targetReps + 2;
                if (validReps.includes(candidate)) return candidate;
                return targetReps;
            }
            
            // AMRAP or Bodybuilding = +2 or +3 as before
            let candidate = targetReps + 2;
            if (validReps.includes(candidate)) return candidate;
            
            candidate = targetReps + 3;
            if (validReps.includes(candidate)) return candidate;
            
            for (let r of validReps) {
                if (r > targetReps) return r;
            }
            return targetReps;
        }

        function updateE1RM(lift) {
            const weight = parseFloat(document.getElementById(`${lift}-weight`).value);
            const reps = parseInt(document.getElementById(`${lift}-reps`).value);
            const rpe = parseFloat(document.getElementById(`${lift}-rpe`).value);
            const display = document.getElementById(`${lift}-e1rm`);

            if (weight && reps) {
                const e1rm = calculateE1RM(weight, reps, rpe);
                display.textContent = Math.round(e1rm * 10) / 10 + ' kg';
            } else {
                display.textContent = 'â€”';
            }
        }

        function handleFocusChange() {
            const focus = document.getElementById('accessoryFocus').value;
            const daysSelect = document.getElementById('trainingDays');
            
            if (focus === 'benchmax' || focus === 'beginner_machine') {
                daysSelect.value = '4';
                daysSelect.disabled = true;
            } else {
                daysSelect.disabled = false;
            }

            // For beginner_machine: make all weight inputs non-mandatory
            const allWeightInputs = document.querySelectorAll('input[type="number"]');
            if (focus === 'beginner_machine') {
                allWeightInputs.forEach(inp => {
                    inp.removeAttribute('required');
                    inp.placeholder = 'â€” (optional)';
                });
                document.querySelector('.section-title').innerHTML = 'Your Numbers <span style="font-family: 'IBM Plex Mono', monospace; font-size: 0.65rem; color: var(--text-muted); font-weight: 400;">(all optional â€” weights auto-estimated if left blank)</span>';
            } else {
                const placeholders = {
                    'dead-weight': '140', 'squat-weight': '120', 'bench-weight': '80',
                    'ohp-weight': '50', 'row-weight': 'â€”', 'frontsquat-weight': 'â€”',
                    'rdl-weight': 'â€”', 'larsen-weight': 'â€”'
                };
                allWeightInputs.forEach(inp => {
                    inp.placeholder = placeholders[inp.id] || 'â€”';
                });
                document.querySelector('.section-title').innerHTML = 'Main Lifts <span style="font-family: 'IBM Plex Mono', monospace; font-size: 0.65rem; color: var(--text-muted); font-weight: 400;">(add your most recent numbers here to calculate)</span>';
            }
        }

        function toggleCollapsible(header) {
            header.classList.toggle('open');
            header.nextElementSibling.classList.toggle('open');
            const arrow = header.querySelector('.toggle-arrow');
            if (header.classList.contains('open')) {
                arrow.style.transform = 'rotate(180deg)';
            } else {
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        function exportToPDF() {
            // Create a new window with print-friendly content
            const programOutput = document.getElementById('programOutput');
            const focus = document.getElementById('accessoryFocus').value;
            const days = document.getElementById('trainingDays').value;
            const targetReps = document.getElementById('repRange').value;
            
            let focusName = focus === 'bodybuilding' ? 'Bodybuilding' : focus === 'powerlifting' ? 'Powerlifting' : 'Bench Max';
            let daysName = days === '3' ? '3 Day' : '4 Day';
            
            const printContent = `
<!DOCTYPE html>
<html>
<head>
    <title>Training Program</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Helvetica Neue', Arial, sans-serif; 
            font-size: 11px;
            line-height: 1.4;
            color: #222;
            padding: 20px;
        }
        .program-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #333;
        }
        .program-header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        .program-header p {
            font-size: 12px;
            color: #666;
        }
        .week-section {
            page-break-inside: avoid;
            margin-bottom: 25px;
        }
        .week-title {
            background: #333;
            color: white;
            padding: 8px 12px;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .day-section {
            border: 1px solid #ddd;
            margin-bottom: 15px;
            page-break-inside: avoid;
        }
        .day-title {
            background: #f5f5f5;
            padding: 8px 12px;
            font-weight: bold;
            font-size: 12px;
            border-bottom: 1px solid #ddd;
        }
        .exercise-list {
            padding: 10px 12px;
        }
        .exercise-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid #eee;
        }
        .exercise-row:last-child {
            border-bottom: none;
        }
        .exercise-name {
            font-weight: 500;
        }
        .exercise-name.main { color: #7c3aed; font-weight: bold; }
        .exercise-name.secondary { color: #16a34a; }
        .exercise-name.accessory { color: #666; }
        .exercise-prescription {
            text-align: right;
            color: #444;
        }
        .weight { font-weight: bold; color: #000; }
        .section-divider {
            height: 1px;
            background: #ddd;
            margin: 8px 0;
        }
        .superset-label {
            font-size: 9px;
            color: #e65100;
            margin-left: 5px;
        }
        @media print {
            .week-section { page-break-inside: avoid; }
            .day-section { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="program-header">
        <h1>5-Week Training Program</h1>
        <p>${focusName} Focus | ${daysName} Split | ${targetReps} Rep Range</p>
    </div>
    ${extractPrintContent()}
</body>
</html>`;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            
            // Wait for content to load then print
            printWindow.onload = function() {
                printWindow.print();
            };
        }
        
        function extractPrintContent() {
            const weeks = document.querySelectorAll('.week-block');
            let html = '';
            
            weeks.forEach((week, weekIndex) => {
                const weekHeader = week.querySelector('.week-header span:first-child').textContent;
                const rpeBadge = week.querySelector('.rpe-badge').textContent;
                
                html += '<div class="week-section">';
                html += '<div class="week-title">' + weekHeader + ' â€” ' + rpeBadge + '</div>';
                
                const days = week.querySelectorAll('.day-block');
                days.forEach(day => {
                    const dayTitle = day.querySelector('.day-title').textContent;
                    html += '<div class="day-section">';
                    html += '<div class="day-title">' + dayTitle + '</div>';
                    html += '<div class="exercise-list">';
                    
                    const rows = day.querySelectorAll('.exercise-row, .section-divider');
                    rows.forEach(row => {
                        if (row.classList.contains('section-divider')) {
                            html += '<div class="section-divider"></div>';
                        } else {
                            const nameEl = row.querySelector('.exercise-name');
                            const prescEl = row.querySelector('.exercise-prescription');
                            
                            let nameClass = 'accessory';
                            if (nameEl.classList.contains('main') || nameEl.classList.contains('backoff')) nameClass = 'main';
                            else if (nameEl.classList.contains('secondary')) nameClass = 'secondary';
                            
                            const supersetLabel = nameEl.querySelector('.superset-label');
                            const exerciseLabel = nameEl.querySelector('.exercise-label');
                            let nameTxt = nameEl.textContent;
                            if (supersetLabel) nameTxt = nameTxt.replace('Superset', '') + '<span class="superset-label">SUPERSET</span>';
                            if (exerciseLabel) nameTxt = nameTxt.replace(exerciseLabel.textContent, '') + ' <span style="font-size:9px;color:#888;">(' + exerciseLabel.textContent + ')</span>';
                            
                            html += '<div class="exercise-row">';
                            html += '<span class="exercise-name ' + nameClass + '">' + nameTxt + '</span>';
                            html += '<span class="exercise-prescription">' + prescEl.innerHTML + '</span>';
                            html += '</div>';
                        }
                    });
                    
                    html += '</div></div>';
                });
                
                html += '</div>';
            });
            
            return html;
        }

        function generateProgram() {
            const lifts = ['dead', 'squat', 'bench', 'ohp'];
            const e1rms = {};
            
            const isBeginner = document.getElementById('accessoryFocus').value === 'beginner_machine';
            for (const lift of lifts) {
                const weight = parseFloat(document.getElementById(`${lift}-weight`).value);
                const reps = parseInt(document.getElementById(`${lift}-reps`).value);
                const rpe = parseFloat(document.getElementById(`${lift}-rpe`).value);
                
                if (!weight && !isBeginner) {
                    alert('Please enter all four main lift weights');
                    return;
                }
                
                if (weight && !rpe) {
                    alert('Inputs not provided for RPE');
                    return;
                }
                
                if (weight) e1rms[lift] = calculateE1RM(weight, reps, rpe);
            }

            // Optional lifts
            const optionalLifts = ['row', 'frontsquat', 'rdl', 'larsen'];
            for (const lift of optionalLifts) {
                const weight = parseFloat(document.getElementById(`${lift}-weight`).value);
                const reps = parseInt(document.getElementById(`${lift}-reps`).value);
                const rpe = parseFloat(document.getElementById(`${lift}-rpe`).value);
                if (weight) {
                    e1rms[lift] = calculateE1RM(weight, reps, rpe);
                }
            }

            const targetReps = parseInt(document.getElementById('repRange').value);
            const focus = document.getElementById('accessoryFocus').value;
            const days = document.getElementById('trainingDays').value;
            const progressionGoal = document.getElementById('progressionGoal').value;

            let html = '';

            // Weeks 1-4
            const isBegMode = document.getElementById('accessoryFocus').value === 'beginner_machine';
            const weekBadges = isBegMode ? ['Intro', 'Build', 'Push', 'Max Out'] : weeklyRPE.map(r => 'RPE ' + r);
            for (let week = 0; week < 4; week++) {
                const rpe = weeklyRPE[week];
                html += `
                    <div class="week-block week-${week + 1}">
                        <div class="week-header" onclick="toggleWeek(this)">
                            <span>Week ${week + 1}</span>
                            <span class="rpe-badge">${weekBadges[week]}</span>
                            <span class="toggle-arrow">â–¼</span>
                        </div>
                        <div class="week-content ${week === 0 ? 'open' : ''}">
                            ${generateWeekContent(e1rms, week, targetReps, focus, days, false, progressionGoal)}
                        </div>
                    </div>
                `;
            }

            // Week 5 - Deload
            html += `
                <div class="week-block week-5">
                    <div class="week-header" onclick="toggleWeek(this)">
                        <span>Week 5 â€” Deload</span>
                        <span class="rpe-badge">RPE 6</span>
                        <span class="toggle-arrow">â–¼</span>
                    </div>
                    <div class="week-content">
                        ${generateWeekContent(e1rms, 0, targetReps, focus, days, true, progressionGoal)}
                    </div>
                </div>
            `;

            const focusVal = document.getElementById('accessoryFocus').value;
            html += `
                <div class="info-box">
                    ${focusVal === 'beginner_machine' 
                        ? '<strong>Beginner Machine Program:</strong> 4 days/week, Push/Pull + Legs/Core split. Week 4 progression sets are AMRAP. Week 5 is a deload at reduced volume. Focus on controlled form and progressive overload each week.'
                        : `<strong>Progression:</strong> RPE rises from 7 â†’ 8 â†’ 8.5 â†’ 9 across weeks 1-4. 
                    ${progressionGoal === 'reps' 
                        ? 'Week 4 top sets are AMRAP â€” aim for max reps to test your progress.' 
                        : 'Week 4 adds +2.5kg to each top set for weight progression.'}
                    Week 5 is a deload at 50% volume and RPE 6 to recover before the next block.`}
                </div>
            `;

            document.getElementById('programOutput').innerHTML = html;
            document.getElementById('programOutput').classList.add('visible');
            document.getElementById('exportBtn').classList.add('visible');
            document.querySelector('.week-1 .week-header').classList.add('open');
            document.getElementById('programOutput').scrollIntoView({ behavior: 'smooth' });
        }

        function generateWeekContent(e1rms, weekIndex, targetReps, focus, days, isDeload, progressionGoal) {
            let html = '';
            const rpe = isDeload ? 6 : weeklyRPE[weekIndex];
            const isWeek4 = weekIndex === 3;

            if (focus === 'beginner_machine') {
                html += generateBeginnerPushPullDay(weekIndex, isDeload, isWeek4, progressionGoal);
                html += generateBeginnerLegsDay(weekIndex, isDeload, isWeek4, progressionGoal);
                // Day 3 & 4: repeat Day 1 & 2 (second session of the week)
                html += generateBeginnerPushPullDay(weekIndex, isDeload, isWeek4, progressionGoal, true);
                html += generateBeginnerLegsDay(weekIndex, isDeload, isWeek4, progressionGoal, true);
            } else if (focus === 'benchmax') {
                // Bench Max 4-day program
                html += generateBenchDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal, days, 1);
                html += generateBBLegsDay(e1rms, targetReps, rpe, isDeload, isWeek4, progressionGoal, focus);
                html += generatePauseBenchDay(e1rms, targetReps, rpe, isDeload, isWeek4, progressionGoal, focus);
                html += generateLarsenBenchDay(e1rms, targetReps, rpe, isDeload, isWeek4, progressionGoal, focus);
            } else if (days === '4') {
                html += generateSquatDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal);
                html += generateBenchDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal, days, 2);
                html += generateDeadliftDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal);
                html += generatePushPressDay(e1rms, targetReps, rpe, focus, isDeload, days, isWeek4, progressionGoal);
            } else {
                // 3 day - order: Bench, Legs, Push Press
                html += generateBenchDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal, days, 1);
                html += generateCombinedLegsDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal);
                html += generatePushPressDay(e1rms, targetReps, rpe, focus, isDeload, days, isWeek4, progressionGoal);
            }

            return html;
        }

        function generateDeadliftDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal) {
            let topWeight = roundToPlate(calculateWeight(e1rms.dead, targetReps, rpe));
            if (isWeek4 && !isDeload && progressionGoal === 'weight') topWeight += 2.5;
            const isAmrap = isWeek4 && !isDeload && progressionGoal === 'reps';
            
            const backoffReps = getBackoffReps(targetReps, focus, progressionGoal);
            const backoffWeight = roundToPlate(topWeight * backoffPercent);

            // Secondary lift matches back-off reps
            const frontSquatReps = backoffReps;
            const hasFrontSquat = e1rms.frontsquat !== undefined;
            const frontSquatE1RM = hasFrontSquat ? e1rms.frontsquat : (e1rms.squat * 0.85);
            const frontSquatWeight = roundToPlate(calculateWeight(frontSquatE1RM, frontSquatReps, rpe));

            const isPL = focus === 'powerlifting';
            const isBB = focus === 'bodybuilding';
            const accReps = isPL ? 8 : 12;
            const sets = isDeload ? 2 : 3;
            const topSets = 1;
            const backoffSets = isDeload ? 1 : 2;

            let html = `
                <div class="day-block">
                    <div class="day-title">Day 3: Deadlift</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Deadlift<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}Ã—${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${topWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">Deadlift<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}Ã—${backoffReps} @ <span class="weight">${backoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Front Squat / High Bar Squat</span>
                        <span class="exercise-prescription">${sets}Ã—${frontSquatReps} @ <span class="weight">${frontSquatWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
            `;

            if (!isDeload) {
                if (isPL) {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Hamstring Curls</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Planks</span>
                            <span class="exercise-prescription">3Ã—60 seconds</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Hamstring Curls</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Calf Raises</span>
                            <span class="exercise-prescription">4Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Hanging Leg Raises</span>
                            <span class="exercise-prescription">3Ã—Max</span>
                        </div>
                    `;
                }
            }

            html += '</div>';
            return html;
        }

        function generateSquatDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal) {
            let topWeight = roundToPlate(calculateWeight(e1rms.squat, targetReps, rpe));
            if (isWeek4 && !isDeload && progressionGoal === 'weight') topWeight += 2.5;
            const isAmrap = isWeek4 && !isDeload && progressionGoal === 'reps';
            
            const backoffReps = getBackoffReps(targetReps, focus, progressionGoal);
            const backoffWeight = roundToPlate(topWeight * backoffPercent);

            // Secondary lift matches back-off reps
            const rdlReps = backoffReps;
            const hasRDL = e1rms.rdl !== undefined;
            const rdlE1RM = hasRDL ? e1rms.rdl : (e1rms.dead * 0.70);
            const rdlWeight = roundToPlate(calculateWeight(rdlE1RM, rdlReps, rpe));

            const pauseSquatWeight = roundToPlate(backoffWeight * variationPercent);

            const isPL = focus === 'powerlifting';
            const isBB = focus === 'bodybuilding';
            const accReps = isPL ? 8 : 12;
            const sets = isDeload ? 2 : 3;
            const topSets = 1;
            const backoffSets = isDeload ? 1 : 2;

            let html = `
                <div class="day-block">
                    <div class="day-title">Day 1: Squat</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Squat<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}Ã—${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${topWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">Squat<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}Ã—${backoffReps} @ <span class="weight">${backoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Romanian Deadlift</span>
                        <span class="exercise-prescription">${sets}Ã—${rdlReps} @ <span class="weight">${rdlWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
            `;

            if (!isDeload) {
                if (isPL) {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Pause Squats</span>
                            <span class="exercise-prescription">3Ã—${backoffReps} @ <span class="weight">${pauseSquatWeight}kg</span></span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Leg Press</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Planks</span>
                            <span class="exercise-prescription">3Ã—60 seconds</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Leg Press</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Quad Extensions</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Hamstring Curls</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Calf Raises</span>
                            <span class="exercise-prescription">4Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Hanging Leg Raises</span>
                            <span class="exercise-prescription">3Ã—Max</span>
                        </div>
                    `;
                }
            }

            html += '</div>';
            return html;
        }

        function generateBenchDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal, days, dayNum) {
            let topWeight = roundToPlate(calculateWeight(e1rms.bench, targetReps, rpe));
            const weightIncrease = focus === 'benchmax' ? 5 : 2.5;
            if (isWeek4 && !isDeload && progressionGoal === 'weight') topWeight += weightIncrease;
            const isAmrap = isWeek4 && !isDeload && progressionGoal === 'reps';
            
            const backoffReps = getBackoffReps(targetReps, focus, progressionGoal);
            const backoffWeight = roundToPlate(topWeight * backoffPercent);

            const hasLarsen = e1rms.larsen !== undefined;
            let larsenWeight;
            if (hasLarsen) {
                larsenWeight = roundToPlate(calculateWeight(e1rms.larsen, backoffReps, rpe));
            } else {
                larsenWeight = roundToPlate(backoffWeight * variationPercent);
            }

            // Secondary lift matches back-off reps
            const rowReps = backoffReps;

            const isPL = focus === 'powerlifting';
            const isBB = focus === 'bodybuilding';
            const accReps = isPL ? 8 : 10;
            const sets = isDeload ? 2 : 3;
            const topSets = 1;
            const backoffSets = isDeload ? 1 : 2;

            let html = `
                <div class="day-block">
                    <div class="day-title">Day ${dayNum}: Bench Press</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Bench Press<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}Ã—${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${topWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">Bench Press<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}Ã—${backoffReps} @ <span class="weight">${backoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Lat Pulldown</span>
                        <span class="exercise-prescription">${sets}Ã—${rowReps}</span>
                    </div>
                    
                    <div class="section-divider"></div>
            `;

            if (!isDeload) {
                if (isPL) {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Larsen Press</span>
                            <span class="exercise-prescription">3Ã—${backoffReps} @ <span class="weight">${larsenWeight}kg</span></span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Cable Row</span>
                            <span class="exercise-prescription">3Ã—8</span>
                        </div>
                        <div class="section-divider"></div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Barbell Curl</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Barbell Skull Crusher</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                    `;
                } else if (isBB) {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Incline Bench</span>
                            <span class="exercise-prescription">3Ã—${targetReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">DB Flyes</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Cable Row</span>
                            <span class="exercise-prescription">3Ã—8</span>
                        </div>
                        <div class="section-divider"></div>
                        <div class="exercise-row">
                            <span class="exercise-name superset">Incline Curls<span class="superset-label">Superset</span></span>
                            <span class="exercise-prescription">4Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name superset">DB Skull Crushers<span class="superset-label">Superset</span></span>
                            <span class="exercise-prescription">4Ã—${accReps}</span>
                        </div>
                    `;
                } else {
                    // benchmax focus - no Larsen here, it has its own day
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Cable Row</span>
                            <span class="exercise-prescription">3Ã—8</span>
                        </div>
                        <div class="section-divider"></div>
                        <div class="exercise-row">
                            <span class="exercise-name superset">Incline Curls<span class="superset-label">Superset</span></span>
                            <span class="exercise-prescription">4Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name superset">DB Skull Crushers<span class="superset-label">Superset</span></span>
                            <span class="exercise-prescription">4Ã—${accReps}</span>
                        </div>
                    `;
                }
            }

            html += '</div>';
            return html;
        }

        function generatePushPressDay(e1rms, targetReps, rpe, focus, isDeload, days, isWeek4, progressionGoal) {
            let topWeight = roundToPlate(calculateWeight(e1rms.ohp, targetReps, rpe));
            if (isWeek4 && !isDeload && progressionGoal === 'weight') topWeight += 2.5;
            const isAmrap = isWeek4 && !isDeload && progressionGoal === 'reps';
            
            const backoffReps = getBackoffReps(targetReps, focus, progressionGoal);
            const backoffWeight = roundToPlate(topWeight * backoffPercent);

            // Secondary lift matches back-off reps
            const hasRow = e1rms.row !== undefined;
            const rowReps = backoffReps;
            const rowWeight = hasRow ? roundToPlate(calculateWeight(e1rms.row, rowReps, rpe)) : null;

            const isPL = focus === 'powerlifting';
            const isBB = focus === 'bodybuilding';
            const accReps = isPL ? 8 : 10;
            const sets = isDeload ? 2 : 3;
            const topSets = 1;
            const backoffSets = isDeload ? 1 : 2;

            const dayNumber = days === '3' ? '3' : '4';

            let html = `
                <div class="day-block">
                    <div class="day-title">Day ${dayNumber}: Push Press / OHP</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Push Press / OHP<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}Ã—${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${topWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">Push Press / OHP<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}Ã—${backoffReps} @ <span class="weight">${backoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Bent Over Row / Pendlay Row</span>
                        <span class="exercise-prescription">${sets}Ã—${rowReps}${rowWeight ? ` @ <span class="weight">${rowWeight}kg</span>` : ''}</span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Weighted Pull Ups</span>
                        <span class="exercise-prescription">${sets}Ã—6</span>
                    </div>
                    
                    <div class="section-divider"></div>
            `;

            if (!isDeload) {
                if (isPL) {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Barbell Curl</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Barbell Skull Crusher</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Barbell Shrugs</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Lateral Raises</span>
                            <span class="exercise-prescription">4Ã—${accReps}</span>
                        </div>
                        <div class="section-divider"></div>
                        <div class="exercise-row">
                            <span class="exercise-name superset">Incline Curls<span class="superset-label">Superset</span></span>
                            <span class="exercise-prescription">4Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name superset">DB Skull Crushers<span class="superset-label">Superset</span></span>
                            <span class="exercise-prescription">4Ã—${accReps}</span>
                        </div>
                    `;
                }
            }

            html += '</div>';
            return html;
        }

        function generateCombinedLegsDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal) {
            let deadTopWeight = roundToPlate(calculateWeight(e1rms.dead, targetReps, rpe));
            if (isWeek4 && !isDeload && progressionGoal === 'weight') deadTopWeight += 2.5;
            const isAmrap = isWeek4 && !isDeload && progressionGoal === 'reps';
            
            const backoffReps = getBackoffReps(targetReps, focus, progressionGoal);
            const deadBackoffWeight = roundToPlate(deadTopWeight * backoffPercent);

            const isPL = focus === 'powerlifting';
            const isBB = focus === 'bodybuilding';
            const accReps = isPL ? 8 : 12;
            const topSets = 1;
            const backoffSets = isDeload ? 1 : 2;

            // For bodybuilding 3-day: Hack Squats (no weight)
            // For powerlifting 3-day: Squat before Deadlift
            let squatTopWeight = roundToPlate(calculateWeight(e1rms.squat, targetReps, rpe));
            if (isWeek4 && !isDeload && progressionGoal === 'weight') squatTopWeight += 2.5;
            const squatBackoffWeight = roundToPlate(squatTopWeight * backoffPercent);

            let html = `<div class="day-block">`;

            if (isPL) {
                // Powerlifting: Squat first, then Deadlift
                html += `
                    <div class="day-title">Day 2: Squat + Deadlift</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Squat<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}Ã—${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${squatTopWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">Squat<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}Ã—${backoffReps} @ <span class="weight">${squatBackoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Deadlift<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}Ã—${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${deadTopWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">Deadlift<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}Ã—${backoffReps} @ <span class="weight">${deadBackoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
                `;

                if (!isDeload) {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Leg Press</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Hamstring Curls</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Planks</span>
                            <span class="exercise-prescription">3Ã—60 seconds</span>
                        </div>
                    `;
                }
            } else {
                // Bodybuilding: Deadlift + Hack Squats (no weight on hack squats)
                html += `
                    <div class="day-title">Day 2: Deadlift + Hack Squat</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Deadlift<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}Ã—${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${deadTopWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">Deadlift<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}Ã—${backoffReps} @ <span class="weight">${deadBackoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Hack Squat</span>
                        <span class="exercise-prescription">3Ã—${targetReps}</span>
                    </div>
                    
                    <div class="section-divider"></div>
                `;

                if (!isDeload) {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Leg Press</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Hamstring Curls</span>
                            <span class="exercise-prescription">3Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Calf Raises</span>
                            <span class="exercise-prescription">4Ã—${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Hanging Leg Raises</span>
                            <span class="exercise-prescription">3Ã—Max</span>
                        </div>
                    `;
                }
            }

            html += '</div>';
            return html;
        }

        // Bench Max specific days
        function generateBBLegsDay(e1rms, targetReps, rpe, isDeload, isWeek4, progressionGoal, focus) {
            let squatTopWeight = roundToPlate(calculateWeight(e1rms.squat, targetReps, rpe));
            if (isWeek4 && !isDeload && progressionGoal === 'weight') squatTopWeight += 2.5;
            const isAmrap = isWeek4 && !isDeload && progressionGoal === 'reps';
            
            const backoffReps = getBackoffReps(targetReps, focus, progressionGoal);
            const squatBackoffWeight = roundToPlate(squatTopWeight * backoffPercent);

            // Secondary lift matches back-off reps
            const rdlReps = backoffReps;
            const hasRDL = e1rms.rdl !== undefined;
            const rdlE1RM = hasRDL ? e1rms.rdl : (e1rms.dead * 0.70);
            const rdlWeight = roundToPlate(calculateWeight(rdlE1RM, rdlReps, rpe));

            const accReps = 12;
            const sets = isDeload ? 2 : 3;
            const topSets = 1;
            const backoffSets = isDeload ? 1 : 2;

            let html = `
                <div class="day-block">
                    <div class="day-title">Day 2: Legs</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Squat<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}Ã—${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${squatTopWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">Squat<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}Ã—${backoffReps} @ <span class="weight">${squatBackoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Romanian Deadlift</span>
                        <span class="exercise-prescription">${sets}Ã—${rdlReps} @ <span class="weight">${rdlWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
            `;

            if (!isDeload) {
                html += `
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Leg Press</span>
                        <span class="exercise-prescription">3Ã—${accReps}</span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Quad Extensions</span>
                        <span class="exercise-prescription">3Ã—${accReps}</span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Hamstring Curls</span>
                        <span class="exercise-prescription">3Ã—${accReps}</span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Calf Raises</span>
                        <span class="exercise-prescription">4Ã—${accReps}</span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Hanging Leg Raises</span>
                        <span class="exercise-prescription">3Ã—Max</span>
                    </div>
                `;
            }

            html += '</div>';
            return html;
        }

        function generatePauseBenchDay(e1rms, targetReps, rpe, isDeload, isWeek4, progressionGoal, focus) {
            // Pause Bench = Bench - 10%
            let benchTopWeight = roundToPlate(calculateWeight(e1rms.bench, targetReps, rpe));
            if (isWeek4 && !isDeload && progressionGoal === 'weight') benchTopWeight += 5;
            
            const pauseWeight = roundToPlate(benchTopWeight * 0.90);
            const isAmrap = isWeek4 && !isDeload && progressionGoal === 'reps';
            
            const backoffReps = getBackoffReps(targetReps, focus, progressionGoal);
            const backoffWeight = roundToPlate(pauseWeight * backoffPercent);

            // Secondary lift matches back-off reps
            const hasRow = e1rms.row !== undefined;
            const rowReps = backoffReps;
            const rowWeight = hasRow ? roundToPlate(calculateWeight(e1rms.row, rowReps, rpe)) : null;

            const accReps = 10;
            const sets = isDeload ? 2 : 3;
            const topSets = 1;
            const backoffSets = isDeload ? 1 : 2;

            let html = `
                <div class="day-block">
                    <div class="day-title">Day 3: 3-Second Pause Bench</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">3-Second Pause Bench<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}Ã—${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${pauseWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">3-Second Pause Bench<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}Ã—${backoffReps} @ <span class="weight">${backoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Bent Over Row / Pendlay Row</span>
                        <span class="exercise-prescription">${sets}Ã—${rowReps}${rowWeight ? ` @ <span class="weight">${rowWeight}kg</span>` : ''}</span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Weighted Pull Ups</span>
                        <span class="exercise-prescription">${sets}Ã—6</span>
                    </div>
                    
                    <div class="section-divider"></div>
            `;

            if (!isDeload) {
                html += `
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Barbell Shrugs</span>
                        <span class="exercise-prescription">3Ã—${accReps}</span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Lateral Raises</span>
                        <span class="exercise-prescription">4Ã—${accReps}</span>
                    </div>
                    <div class="section-divider"></div>
                    <div class="exercise-row">
                        <span class="exercise-name superset">Incline Curls<span class="superset-label">Superset</span></span>
                        <span class="exercise-prescription">4Ã—${accReps}</span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name superset">DB Skull Crushers<span class="superset-label">Superset</span></span>
                        <span class="exercise-prescription">4Ã—${accReps}</span>
                    </div>
                `;
            }

            html += '</div>';
            return html;
        }

        function generateLarsenBenchDay(e1rms, targetReps, rpe, isDeload, isWeek4, progressionGoal, focus) {
            // Larsen = Bench - 20%
            let benchTopWeight = roundToPlate(calculateWeight(e1rms.bench, targetReps, rpe));
            if (isWeek4 && !isDeload && progressionGoal === 'weight') benchTopWeight += 5;
            
            const larsenWeight = roundToPlate(benchTopWeight * 0.80);
            const isAmrap = isWeek4 && !isDeload && progressionGoal === 'reps';
            
            const backoffReps = getBackoffReps(targetReps, focus, progressionGoal);
            const backoffWeight = roundToPlate(larsenWeight * backoffPercent);

            // Same accessories as Day 1 bench
            const hasLarsen = e1rms.larsen !== undefined;
            let variationWeight;
            if (hasLarsen) {
                variationWeight = roundToPlate(calculateWeight(e1rms.larsen, backoffReps, rpe));
            } else {
                variationWeight = roundToPlate(backoffWeight * variationPercent);
            }

            // Secondary lift matches back-off reps
            const rowReps = backoffReps;
            const accReps = 10;
            const sets = isDeload ? 2 : 3;
            const topSets = 1;
            const backoffSets = isDeload ? 1 : 2;

            let html = `
                <div class="day-block">
                    <div class="day-title">Day 4: Larsen Press</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Larsen Press<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}Ã—${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${larsenWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">Larsen Press<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}Ã—${backoffReps} @ <span class="weight">${backoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Lat Pulldown</span>
                        <span class="exercise-prescription">${sets}Ã—${rowReps}</span>
                    </div>
                    
                    <div class="section-divider"></div>
            `;

            if (!isDeload) {
                html += `
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Close Grip Larsen Press</span>
                        <span class="exercise-prescription">3Ã—${backoffReps} @ <span class="weight">${variationWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Cable Row</span>
                        <span class="exercise-prescription">3Ã—8</span>
                    </div>
                    <div class="section-divider"></div>
                    <div class="exercise-row">
                        <span class="exercise-name superset">Incline Curls<span class="superset-label">Superset</span></span>
                        <span class="exercise-prescription">4Ã—${accReps}</span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name superset">DB Skull Crushers<span class="superset-label">Superset</span></span>
                        <span class="exercise-prescription">4Ã—${accReps}</span>
                    </div>
                `;
            }

            html += '</div>';
            return html;
        }


        function generateBeginnerPushPullDay(weekIndex, isDeload, isWeek4, progressionGoal, isSecondSession) {
            const dayNum = isSecondSession ? 3 : 1;
            const rpeLabels = ['RPE 7', 'RPE 8', 'RPE 8.5', 'RPE 9', 'Deload'];
            const weekLabel = isDeload ? 'Deload' : rpeLabels[weekIndex] || '';
            const isAmrap = isWeek4 && !isDeload && progressionGoal === 'reps';
            const sets = isDeload ? 2 : 3;
            const mainReps = isDeload ? 10 : 12;
            const mainLabel = isAmrap ? 'AMRAP' : `${sets}Ã—${mainReps}`;

            return `
                <div class="day-block">
                    <div class="day-title">Day ${dayNum}: Push / Pull${isDeload ? ' (Deload)' : ''}</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Chest Press Machine<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Working Sets'}</span></span>
                        <span class="exercise-prescription">${isAmrap ? `${sets}Ã—AMRAP` : mainLabel}</span>
                    </div>
                    <div class="section-divider"></div>
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Lat Pulldown Machine</span>
                        <span class="exercise-prescription">${sets}Ã—${mainReps}</span>
                    </div>
                    <div class="section-divider"></div>
                    <div class="exercise-row">
                        <span class="exercise-name main">Shoulder Press Machine<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Working Sets'}</span></span>
                        <span class="exercise-prescription">${isAmrap ? `${sets}Ã—AMRAP` : mainLabel}</span>
                    </div>
                    <div class="section-divider"></div>
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Machine Row</span>
                        <span class="exercise-prescription">${sets}Ã—${mainReps}</span>
                    </div>
                    <div class="section-divider"></div>
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Barbell Curl</span>
                        <span class="exercise-prescription">${sets}Ã—${mainReps}</span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Rope Tricep Pressdown</span>
                        <span class="exercise-prescription">${sets}Ã—${mainReps}</span>
                    </div>
                </div>
            `;
        }

        function generateBeginnerLegsDay(weekIndex, isDeload, isWeek4, progressionGoal, isSecondSession) {
            const dayNum = isSecondSession ? 4 : 2;
            const isAmrap = isWeek4 && !isDeload && progressionGoal === 'reps';
            const sets = isDeload ? 2 : 3;
            const hamSets = isDeload ? 3 : 4;

            return `
                <div class="day-block">
                    <div class="day-title">Day ${dayNum}: Legs / Core${isDeload ? ' (Deload)' : ''}</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Leg Press<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Working Sets'}</span></span>
                        <span class="exercise-prescription">${isAmrap ? `${sets}Ã—AMRAP` : `${sets}Ã—${isDeload ? 12 : 15}`}</span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Quad Extension</span>
                        <span class="exercise-prescription">${sets}Ã—${isDeload ? 10 : 12}</span>
                    </div>
                    <div class="section-divider"></div>
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Hamstring Curl</span>
                        <span class="exercise-prescription">${hamSets}Ã—${isDeload ? 10 : 12}</span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Smith Machine Calf Raises</span>
                        <span class="exercise-prescription">${sets}Ã—${isDeload ? 15 : 20}</span>
                    </div>
                    <div class="section-divider"></div>
                    ${!isDeload ? `
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Leg Raises</span>
                        <span class="exercise-prescription">${sets}Ã—12-15</span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Plank</span>
                        <span class="exercise-prescription">${sets}Ã—30 sec</span>
                    </div>` : `
                    <div class="exercise-row">
                        <span class="exercise-name accessory">Leg Raises</span>
                        <span class="exercise-prescription">2Ã—10</span>
                    </div>`}
                </div>
            `;
        }

        function toggleWeek(header) {
            header.classList.toggle('open');
            header.nextElementSibling.classList.toggle('open');
        }
    </script>
</body>
</html>
