<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5-Week RPE Program Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0a;
            --surface: #141414;
            --surface-hover: #1a1a1a;
            --border: #2a2a2a;
            --text: #e8e8e8;
            --text-muted: #888;
            --accent: #ff4d00;
            --accent-glow: rgba(255, 77, 0, 0.3);
            --success: #00ff88;
            --week1: #ff4d00;
            --week2: #ff8c00;
            --week3: #ffc800;
            --week4: #00ff88;
            --week5: #00bfff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'IBM Plex Mono', monospace;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container { max-width: 900px; margin: 0 auto; padding: 40px 20px; }

        header { text-align: center; margin-bottom: 40px; }

        h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(2.5rem, 8vw, 4rem);
            letter-spacing: 0.05em;
            color: var(--accent);
            text-shadow: 0 0 40px var(--accent-glow);
            line-height: 1;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        .setup-panel {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.4rem;
            letter-spacing: 0.1em;
            color: var(--accent);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .section-subtitle {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin: 25px 0 15px 0;
        }

        .lift-input-block {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 20px;
            margin-bottom: 15px;
        }

        .lift-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.2rem;
            letter-spacing: 0.1em;
            color: var(--success);
            margin-bottom: 15px;
        }

        .lift-name.optional { color: var(--text-muted); }

        .optional-tag {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-family: 'IBM Plex Mono', monospace;
            margin-left: 10px;
        }

        .lift-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        label {
            display: block;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        input, select {
            width: 100%;
            padding: 10px 12px;
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.95rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23888' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }

        .e1rm-display {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 10px;
            text-align: right;
        }

        .e1rm-display span { color: var(--accent); font-weight: 600; }

        .options-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px solid var(--border);
        }

        .generate-btn {
            width: 100%;
            padding: 18px;
            background: var(--accent);
            border: none;
            color: var(--bg);
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 25px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px var(--accent-glow);
        }

        .program-output { display: none; }
        .program-output.visible { display: block; }

        .week-block {
            background: var(--surface);
            border: 1px solid var(--border);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .week-header {
            padding: 15px 20px;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            letter-spacing: 0.1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .week-header:hover { background: var(--surface-hover); }

        .week-1 .week-header { border-left: 4px solid var(--week1); }
        .week-2 .week-header { border-left: 4px solid var(--week2); }
        .week-3 .week-header { border-left: 4px solid var(--week3); }
        .week-4 .week-header { border-left: 4px solid var(--week4); }
        .week-5 .week-header { border-left: 4px solid var(--week5); }

        .week-header .rpe-badge {
            font-size: 0.9rem;
            padding: 4px 12px;
            background: var(--bg);
            border: 1px solid var(--border);
        }

        .week-1 .rpe-badge { color: var(--week1); border-color: var(--week1); }
        .week-2 .rpe-badge { color: var(--week2); border-color: var(--week2); }
        .week-3 .rpe-badge { color: var(--week3); border-color: var(--week3); }
        .week-4 .rpe-badge { color: var(--week4); border-color: var(--week4); }
        .week-5 .rpe-badge { color: var(--week5); border-color: var(--week5); }

        .week-content {
            padding: 0 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, padding 0.4s ease;
        }

        .week-content.open {
            max-height: 5000px;
            padding: 20px;
            border-top: 1px solid var(--border);
        }

        .day-block { 
            margin-bottom: 40px; 
            padding: 20px; 
            background: var(--bg);
            border: 1px solid var(--border);
        }
        .day-block:last-child { margin-bottom: 0; }

        .day-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 0.1em;
            color: var(--accent);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }

        .exercise-row {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            align-items: center;
        }

        .exercise-row:last-child { border-bottom: none; }

        .exercise-name { font-weight: 500; }
        .exercise-name.main { color: var(--success); }
        .exercise-name.backoff { color: var(--success); opacity: 0.7; }
        .exercise-name.secondary { color: var(--accent); }
        .exercise-name.accessory { color: var(--text-muted); }

        .exercise-prescription {
            text-align: right;
            font-size: 0.9rem;
            color: var(--text-muted);
            white-space: nowrap;
        }

        .exercise-prescription .weight { color: var(--text); font-weight: 600; }

        .exercise-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-left: 8px;
        }

        .toggle-arrow { transition: transform 0.3s; }
        .week-header.open .toggle-arrow { transform: rotate(180deg); }

        .section-divider { height: 1px; background: var(--border); margin: 15px 0; }

        .info-box {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 15px;
            margin-top: 20px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .info-box strong { color: var(--accent); }

        @media (max-width: 600px) {
            .container { padding: 20px 15px; }
            .setup-panel { padding: 20px; }
            .lift-inputs { grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
            .lift-input-block { padding: 15px; }
            .exercise-row { grid-template-columns: 1fr; gap: 5px; }
            .exercise-prescription { text-align: left; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>5-Week Program Generator</h1>
            <p class="subtitle">4 weeks + deload</p>
        </header>

        <div class="setup-panel">
            <h2 class="section-title">Main Lifts</h2>
            
            <!-- Deadlift -->
            <div class="lift-input-block">
                <div class="lift-name">Deadlift</div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="dead-weight" placeholder="140" step="2.5" oninput="updateE1RM('dead')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="dead-reps" onchange="updateE1RM('dead')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="dead-rpe" onchange="updateE1RM('dead')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="dead-e1rm">—</span></div>
            </div>

            <!-- Squat -->
            <div class="lift-input-block">
                <div class="lift-name">Squat</div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="squat-weight" placeholder="120" step="2.5" oninput="updateE1RM('squat')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="squat-reps" onchange="updateE1RM('squat')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="squat-rpe" onchange="updateE1RM('squat')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="squat-e1rm">—</span></div>
            </div>

            <!-- Bench -->
            <div class="lift-input-block">
                <div class="lift-name">Bench Press</div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="bench-weight" placeholder="80" step="2.5" oninput="updateE1RM('bench')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="bench-reps" onchange="updateE1RM('bench')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="bench-rpe" onchange="updateE1RM('bench')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="bench-e1rm">—</span></div>
            </div>

            <!-- Push Press -->
            <div class="lift-input-block">
                <div class="lift-name">Push Press / OHP</div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="ohp-weight" placeholder="50" step="2.5" oninput="updateE1RM('ohp')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="ohp-reps" onchange="updateE1RM('ohp')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="ohp-rpe" onchange="updateE1RM('ohp')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="ohp-e1rm">—</span></div>
            </div>

            <h3 class="section-subtitle">Secondary Lifts (Optional)</h3>
            <p style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 15px;">Weights are either calculated or left blank if these fields are unoccupied</p>

            <!-- Row -->
            <div class="lift-input-block">
                <div class="lift-name optional">Bent Over Row / Pendlay Row<span class="optional-tag">(for Push Press day)</span></div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="row-weight" placeholder="—" step="2.5" oninput="updateE1RM('row')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="row-reps" onchange="updateE1RM('row')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="row-rpe" onchange="updateE1RM('row')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="row-e1rm">—</span></div>
            </div>

            <!-- Front Squat / High Bar Squat -->
            <div class="lift-input-block">
                <div class="lift-name optional">Front Squat / High Bar Squat<span class="optional-tag">(for Deadlift day)</span></div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="frontsquat-weight" placeholder="—" step="2.5" oninput="updateE1RM('frontsquat')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="frontsquat-reps" onchange="updateE1RM('frontsquat')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="frontsquat-rpe" onchange="updateE1RM('frontsquat')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="frontsquat-e1rm">—</span></div>
            </div>

            <!-- Romanian Deadlift -->
            <div class="lift-input-block">
                <div class="lift-name optional">Romanian Deadlift<span class="optional-tag">(for Squat day)</span></div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="rdl-weight" placeholder="—" step="2.5" oninput="updateE1RM('rdl')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="rdl-reps" onchange="updateE1RM('rdl')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="rdl-rpe" onchange="updateE1RM('rdl')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="rdl-e1rm">—</span></div>
            </div>

            <!-- Larsen Press -->
            <div class="lift-input-block">
                <div class="lift-name optional">Larsen Press<span class="optional-tag">(for Bench day - PL focus)</span></div>
                <div class="lift-inputs">
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="larsen-weight" placeholder="—" step="2.5" oninput="updateE1RM('larsen')">
                    </div>
                    <div class="input-group">
                        <label>Reps</label>
                        <select id="larsen-reps" onchange="updateE1RM('larsen')">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="5" selected>5</option>
                            <option value="6">6</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>RPE</label>
                        <select id="larsen-rpe" onchange="updateE1RM('larsen')">
                            <option value="6">6</option>
                            <option value="6.5">6.5</option>
                            <option value="7">7</option>
                            <option value="7.5">7.5</option>
                            <option value="8" selected>8</option>
                            <option value="8.5">8.5</option>
                            <option value="9">9</option>
                            <option value="9.5">9.5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                </div>
                <div class="e1rm-display">Est. 1RM: <span id="larsen-e1rm">—</span></div>
            </div>

            <div class="options-row">
                <div class="input-group">
                    <label>Target Rep Range</label>
                    <select id="repRange">
                        <option value="1">1 rep (Peaking)</option>
                        <option value="2">2 reps</option>
                        <option value="3">3 reps (Strength)</option>
                        <option value="5" selected>5 reps (Balanced)</option>
                        <option value="6">6 reps</option>
                        <option value="8">8 reps (Hypertrophy)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Accessory Focus</label>
                    <select id="accessoryFocus">
                        <option value="bodybuilding">Bodybuilding</option>
                        <option value="powerlifting">Powerlifting</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Training Days</label>
                    <select id="trainingDays">
                        <option value="4" selected>4 Days (Recommended)</option>
                        <option value="3">3 Days (Combined Legs)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Progression Goal</label>
                    <select id="progressionGoal">
                        <option value="reps">More Reps (Week 4 AMRAP)</option>
                        <option value="weight">More Weight (+2.5kg Week 4)</option>
                    </select>
                </div>
            </div>

            <button class="generate-btn" onclick="generateProgram()">Generate Program</button>
        </div>

        <div class="program-output" id="programOutput"></div>
    </div>

    <script>
        const rpeChart = {
            10:   [100, 95.5, 92.2, 89.2, 86.3, 83.7, 81.1, 78.6, 76.2, 73.9, 71.7, 69.4],
            9.5:  [97.8, 93.9, 90.7, 87.8, 85.0, 82.4, 79.9, 77.4, 75.1, 72.9, 70.7, 68.6],
            9:    [95.5, 92.2, 89.2, 86.3, 83.7, 81.1, 78.6, 76.2, 73.9, 71.7, 69.4, 67.5],
            8.5:  [93.9, 90.7, 87.8, 85.0, 82.4, 79.9, 77.4, 75.1, 72.9, 70.7, 68.6, 66.7],
            8:    [92.2, 89.2, 86.3, 83.7, 81.1, 78.6, 76.2, 73.9, 71.7, 69.4, 67.5, 65.3],
            7.5:  [90.7, 87.8, 85.0, 82.4, 79.9, 77.4, 75.1, 72.9, 70.7, 68.6, 66.7, 64.0],
            7:    [89.2, 86.3, 83.7, 81.1, 78.6, 76.2, 73.9, 71.7, 69.4, 67.5, 65.3, 62.6],
            6.5:  [87.8, 85.0, 82.4, 79.9, 77.4, 75.1, 72.9, 70.7, 68.6, 66.7, 64.0, 61.3],
            6:    [86.3, 83.7, 81.1, 78.6, 76.2, 73.9, 71.7, 69.4, 67.5, 65.3, 62.6, 59.9]
        };

        const weeklyRPE = [7, 8, 8.5, 9];
        const validReps = [1, 2, 3, 5, 6, 8];
        const backoffPercent = 0.85;
        const variationPercent = 0.85; // 15% off back-off for variations

        function getPercentage(reps, rpe) {
            const repIndex = Math.min(Math.max(reps - 1, 0), 11);
            return rpeChart[rpe][repIndex];
        }

        function calculateE1RM(weight, reps, rpe) {
            const percentage = getPercentage(reps, rpe);
            return weight / (percentage / 100);
        }

        function calculateWeight(e1rm, reps, rpe) {
            const percentage = getPercentage(reps, rpe);
            return e1rm * (percentage / 100);
        }

        function roundToPlate(weight) {
            return Math.round(weight / 2.5) * 2.5;
        }

        function getBackoffReps(targetReps) {
            // If at max rep range (8), don't increase reps
            if (targetReps === 8) return 8;
            
            // Try +2 first
            let candidate = targetReps + 2;
            if (validReps.includes(candidate)) return candidate;
            
            // Try +3
            candidate = targetReps + 3;
            if (validReps.includes(candidate)) return candidate;
            
            // Fallback to next valid rep
            for (let r of validReps) {
                if (r > targetReps) return r;
            }
            return targetReps;
        }

        function updateE1RM(lift) {
            const weight = parseFloat(document.getElementById(`${lift}-weight`).value);
            const reps = parseInt(document.getElementById(`${lift}-reps`).value);
            const rpe = parseFloat(document.getElementById(`${lift}-rpe`).value);
            const display = document.getElementById(`${lift}-e1rm`);

            if (weight && reps) {
                const e1rm = calculateE1RM(weight, reps, rpe);
                display.textContent = Math.round(e1rm * 10) / 10 + ' kg';
            } else {
                display.textContent = '—';
            }
        }

        function generateProgram() {
            const lifts = ['dead', 'squat', 'bench', 'ohp'];
            const e1rms = {};
            
            for (const lift of lifts) {
                const weight = parseFloat(document.getElementById(`${lift}-weight`).value);
                const reps = parseInt(document.getElementById(`${lift}-reps`).value);
                const rpe = parseFloat(document.getElementById(`${lift}-rpe`).value);
                
                if (!weight) {
                    alert('Please enter all four main lift weights');
                    return;
                }
                
                e1rms[lift] = calculateE1RM(weight, reps, rpe);
            }

            // Optional row e1rm
            const rowWeight = parseFloat(document.getElementById('row-weight').value);
            const rowReps = parseInt(document.getElementById('row-reps').value);
            const rowRpe = parseFloat(document.getElementById('row-rpe').value);
            if (rowWeight) {
                e1rms.row = calculateE1RM(rowWeight, rowReps, rowRpe);
            }

            // Optional front squat / high bar e1rm
            const frontSquatWeight = parseFloat(document.getElementById('frontsquat-weight').value);
            const frontSquatReps = parseInt(document.getElementById('frontsquat-reps').value);
            const frontSquatRpe = parseFloat(document.getElementById('frontsquat-rpe').value);
            if (frontSquatWeight) {
                e1rms.frontsquat = calculateE1RM(frontSquatWeight, frontSquatReps, frontSquatRpe);
            }

            // Optional RDL e1rm
            const rdlWeight = parseFloat(document.getElementById('rdl-weight').value);
            const rdlReps = parseInt(document.getElementById('rdl-reps').value);
            const rdlRpe = parseFloat(document.getElementById('rdl-rpe').value);
            if (rdlWeight) {
                e1rms.rdl = calculateE1RM(rdlWeight, rdlReps, rdlRpe);
            }

            // Optional Larsen Press e1rm
            const larsenWeight = parseFloat(document.getElementById('larsen-weight').value);
            const larsenReps = parseInt(document.getElementById('larsen-reps').value);
            const larsenRpe = parseFloat(document.getElementById('larsen-rpe').value);
            if (larsenWeight) {
                e1rms.larsen = calculateE1RM(larsenWeight, larsenReps, larsenRpe);
            }

            const targetReps = parseInt(document.getElementById('repRange').value);
            const focus = document.getElementById('accessoryFocus').value;
            const days = document.getElementById('trainingDays').value;
            const progressionGoal = document.getElementById('progressionGoal').value;

            let html = '';

            // Weeks 1-4
            for (let week = 0; week < 4; week++) {
                const rpe = weeklyRPE[week];
                html += `
                    <div class="week-block week-${week + 1}">
                        <div class="week-header" onclick="toggleWeek(this)">
                            <span>Week ${week + 1}</span>
                            <span class="rpe-badge">RPE ${rpe}</span>
                            <span class="toggle-arrow">▼</span>
                        </div>
                        <div class="week-content ${week === 0 ? 'open' : ''}">
                            ${generateWeekContent(e1rms, week, targetReps, focus, days, false, progressionGoal)}
                        </div>
                    </div>
                `;
            }

            // Week 5 - Deload
            html += `
                <div class="week-block week-5">
                    <div class="week-header" onclick="toggleWeek(this)">
                        <span>Week 5 — Deload</span>
                        <span class="rpe-badge">RPE 6</span>
                        <span class="toggle-arrow">▼</span>
                    </div>
                    <div class="week-content">
                        ${generateWeekContent(e1rms, 0, targetReps, focus, days, true, progressionGoal)}
                    </div>
                </div>
            `;

            html += `
                <div class="info-box">
                    <strong>Progression:</strong> RPE rises from 7 → 8 → 8.5 → 9 across weeks 1-4. 
                    ${progressionGoal === 'reps' 
                        ? 'Week 4 top sets are AMRAP — aim for max reps to test your progress.' 
                        : 'Week 4 adds +2.5kg to each top set for weight progression.'}
                    Week 5 is a deload at 50% volume and RPE 6 to recover before the next block.
                </div>
            `;

            document.getElementById('programOutput').innerHTML = html;
            document.getElementById('programOutput').classList.add('visible');
            document.querySelector('.week-1 .week-header').classList.add('open');
            document.getElementById('programOutput').scrollIntoView({ behavior: 'smooth' });
        }

        function generateWeekContent(e1rms, weekIndex, targetReps, focus, days, isDeload, progressionGoal) {
            let html = '';
            const rpe = isDeload ? 6 : weeklyRPE[weekIndex];
            const isWeek4 = weekIndex === 3;

            if (days === '4') {
                html += generateDeadliftDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal);
                html += generateBenchDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal);
                html += generateSquatDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal);
                html += generatePushPressDay(e1rms, targetReps, rpe, focus, isDeload, days, isWeek4, progressionGoal);
            } else {
                html += generateCombinedLegsDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal);
                html += generateBenchDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal);
                html += generatePushPressDay(e1rms, targetReps, rpe, focus, isDeload, days, isWeek4, progressionGoal);
            }

            return html;
        }

        function generateDeadliftDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal) {
            let topWeight = roundToPlate(calculateWeight(e1rms.dead, targetReps, rpe));
            
            // Week 4 progression
            if (isWeek4 && !isDeload && progressionGoal === 'weight') {
                topWeight += 2.5;
            }
            const isAmrap = isWeek4 && !isDeload && progressionGoal === 'reps';
            
            const backoffReps = getBackoffReps(targetReps);
            const backoffWeight = roundToPlate(topWeight * backoffPercent);

            // Secondary: Front Squat / High Bar - use input if provided, else 85% of squat e1RM
            const frontSquatReps = getBackoffReps(targetReps);
            const hasFrontSquat = e1rms.frontsquat !== undefined;
            const frontSquatE1RM = hasFrontSquat ? e1rms.frontsquat : (e1rms.squat * 0.85);
            const frontSquatWeight = roundToPlate(calculateWeight(frontSquatE1RM, frontSquatReps, rpe));

            const isPL = focus === 'powerlifting';
            const accReps = isPL ? 8 : 12;
            const sets = isDeload ? 2 : 3;
            const topSets = isDeload ? 1 : 1;
            const backoffSets = isDeload ? 1 : 2;

            let html = `
                <div class="day-block">
                    <div class="day-title">Day 1: Deadlift</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Deadlift<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}×${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${topWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">Deadlift<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}×${backoffReps} @ <span class="weight">${backoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Front Squat / High Bar Squat</span>
                        <span class="exercise-prescription">${sets}×${frontSquatReps} @ <span class="weight">${frontSquatWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
            `;

            if (!isDeload) {
                if (isPL) {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Hamstring Curls</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Hamstring Curls</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Calf Raises</span>
                            <span class="exercise-prescription">4×${accReps}</span>
                        </div>
                    `;
                }
            }

            html += '</div>';
            return html;
        }

        function generateSquatDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal) {
            let topWeight = roundToPlate(calculateWeight(e1rms.squat, targetReps, rpe));
            
            // Week 4 progression
            if (isWeek4 && !isDeload && progressionGoal === 'weight') {
                topWeight += 2.5;
            }
            const isAmrap = isWeek4 && !isDeload && progressionGoal === 'reps';
            
            const backoffReps = getBackoffReps(targetReps);
            const backoffWeight = roundToPlate(topWeight * backoffPercent);

            // Secondary: RDL - use input if provided, else 70% of deadlift e1RM
            const rdlReps = getBackoffReps(targetReps);
            const hasRDL = e1rms.rdl !== undefined;
            const rdlE1RM = hasRDL ? e1rms.rdl : (e1rms.dead * 0.70);
            const rdlWeight = roundToPlate(calculateWeight(rdlE1RM, rdlReps, rpe));

            // Variation: Pause Squat @ 85% of back-off weight
            const pauseSquatWeight = roundToPlate(backoffWeight * variationPercent);

            const isPL = focus === 'powerlifting';
            const accReps = isPL ? 8 : 12;
            const sets = isDeload ? 2 : 3;
            const topSets = isDeload ? 1 : 1;
            const backoffSets = isDeload ? 1 : 2;

            let html = `
                <div class="day-block">
                    <div class="day-title">Day 3: Squat</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Squat<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}×${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${topWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">Squat<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}×${backoffReps} @ <span class="weight">${backoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Romanian Deadlift</span>
                        <span class="exercise-prescription">${sets}×${rdlReps} @ <span class="weight">${rdlWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
            `;

            if (!isDeload) {
                if (isPL) {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Pause Squats</span>
                            <span class="exercise-prescription">3×${backoffReps} @ <span class="weight">${pauseSquatWeight}kg</span></span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Leg Press</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Leg Press</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Quad Extensions</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Hamstring Curls</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Calf Raises</span>
                            <span class="exercise-prescription">4×${accReps}</span>
                        </div>
                    `;
                }
            }

            html += '</div>';
            return html;
        }

        function generateBenchDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal) {
            let topWeight = roundToPlate(calculateWeight(e1rms.bench, targetReps, rpe));
            
            // Week 4 progression
            if (isWeek4 && !isDeload && progressionGoal === 'weight') {
                topWeight += 2.5;
            }
            const isAmrap = isWeek4 && !isDeload && progressionGoal === 'reps';
            
            const backoffReps = getBackoffReps(targetReps);
            const backoffWeight = roundToPlate(topWeight * backoffPercent);

            // Variation: Larsen Press - use input if provided, else 85% of back-off weight
            const hasLarsen = e1rms.larsen !== undefined;
            let larsenWeight;
            if (hasLarsen) {
                larsenWeight = roundToPlate(calculateWeight(e1rms.larsen, backoffReps, rpe));
            } else {
                larsenWeight = roundToPlate(backoffWeight * variationPercent);
            }

            // Secondary: Lat Pulldown (no weight calculation)
            const rowReps = getBackoffReps(targetReps);

            const isPL = focus === 'powerlifting';
            const accReps = isPL ? 8 : 10;
            const sets = isDeload ? 2 : 3;
            const topSets = isDeload ? 1 : 1;
            const backoffSets = isDeload ? 1 : 2;

            let html = `
                <div class="day-block">
                    <div class="day-title">Day 2: Bench Press</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Bench Press<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}×${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${topWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">Bench Press<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}×${backoffReps} @ <span class="weight">${backoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Lat Pulldown</span>
                        <span class="exercise-prescription">${sets}×${rowReps}</span>
                    </div>
                    
                    <div class="section-divider"></div>
            `;

            if (!isDeload) {
                if (isPL) {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Larsen Press</span>
                            <span class="exercise-prescription">3×${backoffReps} @ <span class="weight">${larsenWeight}kg</span></span>
                        </div>
                        <div class="section-divider"></div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Barbell Curl</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Barbell Skull Crusher</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">DB Flyes</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                        <div class="section-divider"></div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Incline Curls</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">DB Skull Crushers</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                    `;
                }
            }

            html += '</div>';
            return html;
        }

        function generatePushPressDay(e1rms, targetReps, rpe, focus, isDeload, days, isWeek4, progressionGoal) {
            let topWeight = roundToPlate(calculateWeight(e1rms.ohp, targetReps, rpe));
            
            // Week 4 progression
            if (isWeek4 && !isDeload && progressionGoal === 'weight') {
                topWeight += 2.5;
            }
            const isAmrap = isWeek4 && !isDeload && progressionGoal === 'reps';
            
            const backoffReps = getBackoffReps(targetReps);
            const backoffWeight = roundToPlate(topWeight * backoffPercent);

            // Secondary: Bent Over Row / Pendlay Row (if provided)
            const hasRow = e1rms.row !== undefined;
            const rowReps = getBackoffReps(targetReps);
            const rowWeight = hasRow ? roundToPlate(calculateWeight(e1rms.row, rowReps, rpe)) : null;

            const isPL = focus === 'powerlifting';
            const accReps = isPL ? 8 : 10;
            const sets = isDeload ? 2 : 3;
            const topSets = isDeload ? 1 : 1;
            const backoffSets = isDeload ? 1 : 2;

            let html = `
                <div class="day-block">
                    <div class="day-title">Day ${days === '3' ? '3' : '4'}: Push Press / OHP</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Push Press / OHP<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}×${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${topWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">Push Press / OHP<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}×${backoffReps} @ <span class="weight">${backoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Bent Over Row / Pendlay Row</span>
                        <span class="exercise-prescription">${sets}×${rowReps}${rowWeight ? ` @ <span class="weight">${rowWeight}kg</span>` : ''}</span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name secondary">Weighted Pull Ups</span>
                        <span class="exercise-prescription">${sets}×6</span>
                    </div>
                    
                    <div class="section-divider"></div>
            `;

            if (!isDeload) {
                if (isPL) {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Barbell Curl</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Barbell Skull Crusher</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Barbell Shrugs</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Lateral Raises</span>
                            <span class="exercise-prescription">4×${accReps}</span>
                        </div>
                        <div class="section-divider"></div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Incline Curls</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">DB Skull Crushers</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                    `;
                }
            }

            html += '</div>';
            return html;
        }

        function generateCombinedLegsDay(e1rms, targetReps, rpe, focus, isDeload, isWeek4, progressionGoal) {
            let deadTopWeight = roundToPlate(calculateWeight(e1rms.dead, targetReps, rpe));
            let squatTopWeight = roundToPlate(calculateWeight(e1rms.squat, targetReps, rpe));
            
            // Week 4 progression
            if (isWeek4 && !isDeload && progressionGoal === 'weight') {
                deadTopWeight += 2.5;
                squatTopWeight += 2.5;
            }
            const isAmrap = isWeek4 && !isDeload && progressionGoal === 'reps';
            
            const backoffReps = getBackoffReps(targetReps);
            const deadBackoffWeight = roundToPlate(deadTopWeight * backoffPercent);
            const squatBackoffWeight = roundToPlate(squatTopWeight * backoffPercent);

            const isPL = focus === 'powerlifting';
            const accReps = isPL ? 8 : 12;
            const topSets = isDeload ? 1 : 1;
            const backoffSets = isDeload ? 1 : 2;

            let html = `
                <div class="day-block">
                    <div class="day-title">Day 1: Deadlift + Squat</div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Deadlift<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}×${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${deadTopWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">Deadlift<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}×${backoffReps} @ <span class="weight">${deadBackoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <div class="exercise-row">
                        <span class="exercise-name main">Squat<span class="exercise-label">${isAmrap ? 'AMRAP' : 'Top Set'}</span></span>
                        <span class="exercise-prescription">${topSets}×${isAmrap ? 'AMRAP' : targetReps} @ <span class="weight">${squatTopWeight}kg</span></span>
                    </div>
                    <div class="exercise-row">
                        <span class="exercise-name backoff">Squat<span class="exercise-label">Back-off</span></span>
                        <span class="exercise-prescription">${backoffSets}×${backoffReps} @ <span class="weight">${squatBackoffWeight}kg</span></span>
                    </div>
                    
                    <div class="section-divider"></div>
            `;

            if (!isDeload) {
                if (isPL) {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Leg Press</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Leg Press</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Hamstring Curls</span>
                            <span class="exercise-prescription">3×${accReps}</span>
                        </div>
                        <div class="exercise-row">
                            <span class="exercise-name accessory">Calf Raises</span>
                            <span class="exercise-prescription">4×${accReps}</span>
                        </div>
                    `;
                }
            }

            html += '</div>';
            return html;
        }

        function toggleWeek(header) {
            header.classList.toggle('open');
            header.nextElementSibling.classList.toggle('open');
        }
    </script>
</body>
</html>
